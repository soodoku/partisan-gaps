------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  D:\partisan-gaps\scripts\Stata\logs/partisan-gaps.txt
  log type:  text
 opened on:   6 Apr 2022, 16:08:43

. 
. version 13              // Still on version 13 :(

. 
. global figsavedir `rootdir'/figs

. global tabsavedir `rootdir'/tabs

. adopath ++ ./ado                // Add path to ados
  [1]              "./ado"
  [2]  (BASE)      "C:\Program Files (x86)\Stata13\ado\base/"
  [3]  (SITE)      "C:\Program Files (x86)\Stata13\ado\site/"
  [4]              "."
  [5]  (PERSONAL)  "c:\ado\personal/"
  [6]  (PLUS)      "c:\ado\plus/"
  [7]  (OLDPLACE)  "c:\ado/"

. 
. *** Setup dependencies
. txt2macro stata-requirements.txt

. setup "`r(mymacro)'"
Installing ssc packages, please wait...
sssssss
. * -----------------------------------------------------------------------------
. tictoc tic
------------------------------------------------------------------------------------------------------------------------
----------- Time log -----------
Start time:  6 Apr 2022 16:08:43
------------------------------------------------------------------------------------------------------------------------

. 
. *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
. * MTurk results
. *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
. **** Basic prep of data
. import delimited `rootdir'/data/turk/mturk-recoded.csv
(344 vars, 1253 obs)

. do ./mturk/preamble.do

. global items    birth religion illegal death increase science fraud mmr deficit

. global arms             RW IPS FSR 14k 24k

. global demo     age i.female i.educ i.hisla $races

. 
. rename v1 id

. label var id "Participant ID"

. 
. rename avg avg_str

. destring avg_str, gen(avg) force
avg_str contains nonnumeric characters; avg generated as double
(2 missing values generated)

. 
. *------------------------------------------------------------------------------
. *** Response for the 9 items
. label define itemResponseLabel 1 "Correct" 0 "Incorrect"

. 
. foreach var of varlist $items {
  2.         tempvar _`var'
  3.         gen `_`var'' = `var'
  4.         drop `var'
  5.         gen `var' = (`_`var''=="TRUE") if (`_`var''!="NA")
  6.         label variable `var' "=1 if response is congenial to party for `var' item"
  7.         label values `var' itemResponseLabel
  8. }
(24 missing values generated)
(35 missing values generated)
(113 missing values generated)
(115 missing values generated)
(18 missing values generated)
(12 missing values generated)
(18 missing values generated)
(31 missing values generated)
(82 missing values generated)

. 
. replace deficit = 1 - deficit
(1171 real changes made)

. 
. *------------------------------------------------------------------------------
. *** pid
. rename pid pid_str

. drop if pid_str =="Something else"
(46 observations deleted)

. 
. label define pidLabel 1 "Democrat" 2 "Independent" 3 "Republican"

. encode pid_str, gen(pid) label(pidLabel)

. 
. fvset base 2 pid // permanently set Independent as base

. 
. gen rep = (pid_str=="Republican") if !missing(pid_str)

. 
. *------------------------------------------------------------------------------
. *** Demo
. rename gender gender_str

. label define genderLabel 0 "Male" 1 "Female"

. encode gender_str, gen(female) label(genderLabel)

. 
. foreach demo in educ hisla race {
  2.         rename `demo' `demo'_str
  3.         encode `demo'_str, gen(`demo')
  4. }

. 
. gen asian = strmatch(race_str, "Asian*")

. gen black = strmatch(race_str, "Black*")

. gen white = strmatch(race_str, "White*")

. gen others = strmatch(race_str, "Other*")

. global races asian black white others

. 
. *------------------------------------------------------------------------------
. *** Survey types
. encode question_type, gen(survey)

. fvset base 5 survey // permanently set RW as base

. 
end of do-file

. 
. // **** Figure for raw partisan gaps by items, by survey type
. do ./mturk/fig-partisan-gap.do

. grstyle init

. grstyle set plain, 

. 
. eststo clear

. foreach item of varlist $items avg {
  2.         foreach arm in $arms {
  3.                 qui: reg `item' ib1.pid if (pid_str!="Independent") & (question_type=="`arm'"), vce(hc3)
  4.                 est store `item'_`arm'          
  5.         }
  6. 
.         // * For all arms together
.         // qui: reg `item' ib1.pid if (pid_str!="Independent") 
.         // est store `item'_all 
. }

. 
. 
. coefplot (*_RW) || (*_IPS) || (*_FSR) || (*_14k) || (*_24k), ///
>         msymbol(s) ///
>         keep(3.pid) ///
>         asequation /// "set equation to model name or string" make the rows the models
>         swapnames /// "swap coefficient names and equation names"
>         subtitle("") /// Remove subtitles for now
>         byopts(row(1)) /// Force results to be in one row (1xn)
>         xline(0, lcolor(gs10) lpattern(dash) lwidth(medium)) ///
>         xlabel(-.3(.3).6) ///
>         xscale(range(-.2 .53)) ///
>         plotregion(margin(zero) ) ///   
>         plotregion(lcolor(black) margin(zero) lwidth(medthin)) /// draw box around columns
>         graphregion(margin(zero)) ///
>         ytick(none) /// remove horizontal grids
>         yscale(noline alt)  /// swap labels to RHS
>         eqrename( ///
>                 birth_RW = "{bf:Obama birthplace}" ///
>                 birth_IPS = "{bf:Obama birthplace}" ///
>                 birth_FSR = "{bf:Obama birthplace}" ///
>                 birth_14k = "{bf:Obama birthplace}" ///
>                 birth_24k = "{bf:Obama birthplace}" ///
>                 birth_all = "{bf:Obama birthplace}" ///
>                 religion_RW = "{bf:Obama religion}" ///                                                               
>                                     " ///
>                 religion_IPS = "{bf:Obama religion}" ///
>                 religion_FSR = "{bf:Obama religion}" ///
>                 religion_14k = "{bf:Obama religion}" ///
>                 religion_24k = "{bf:Obama religion}" ///
>                 religion_all = "{bf:Obama religion}" ///
>                 illegal_RW = "{bf:ACA illegal}" ///
>                 illegal_IPS = "{bf:ACA illegal}" ///
>                 illegal_FSR = "{bf:ACA illegal}" ///
>                 illegal_14k = "{bf:ACA illegal}" ///
>                 illegal_24k = "{bf:ACA illegal}" ///
>                 illegal_all = "{bf:ACA illegal}" ///
>                 death_RW = "{bf:ACA death panels}" ///
>                 death_IPS = "{bf:ACA death panels}" ///
>                 death_FSR = "{bf:ACA death panels}" ///
>                 death_14k = "{bf:ACA death panels}" ///
>                 death_24k = "{bf:ACA death panels}" ///
>                 death_all = "{bf:ACA death panels}" ///
>                 increase_RW = "{bf:GW causes}" ///
>                 increase_IPS = "{bf:GW causes}" ///
>                 increase_FSR = "{bf:GW causes}" ///
>                 increase_14k = "{bf:GW causes}" ///
>                 increase_24k = "{bf:GW causes}" ///
>                 increase_all = "{bf:GW causes}" ///
>                 science_RW = "{bf:GW scientists agree}" ///
>                 science_IPS = "{bf:GW scientists agree}" ///
>                 science_FSR = "{bf:GW scientists agree}" ///
>                 science_14k = "{bf:GW scientists agree}" ///
>                 science_24k = "{bf:GW scientists agree}" ///
>                 science_all = "{bf:GW scientists agree}" ///
>                 fraud_RW = "{bf:Voter fraud}" ///
>                 fraud_IPS = "{bf:Voter fraud}" ///
>                 fraud_FSR = "{bf:Voter fraud}" ///
>                 fraud_14k = "{bf:Voter fraud}" ///
>                 fraud_24k = "{bf:Voter fraud}" ///
>                 fraud_all = "{bf:Voter fraud}" ///
>                 mmr_RW = "{bf:MMR vaccine}" ///
>                 mmr_IPS = "{bf:MMR vaccine}" ///
>                 mmr_FSR = "{bf:MMR vaccine}" ///
>                 mmr_14k = "{bf:MMR vaccine}" ///
>                 mmr_24k = "{bf:MMR vaccine}" ///
>                 mmr_all = "{bf:MMR vaccine}" ///
>                 deficit_RW = "{bf:Budget deficit}" ///
>                 deficit_IPS = "{bf:Budget deficit}" ///
>                 deficit_FSR = "{bf:Budget deficit}" ///
>                 deficit_14k = "{bf:Budget deficit}" ///
>                 deficit_24k = "{bf:Budget deficit}" ///
>                 deficit_all = "{bf:Budget deficit}" ///         
>                 avg_RW = "{bf:Average}" ///                                                             
>                 avg_IPS = "{bf:Average}" ///                                                            
>                 avg_FSR = "{bf:Average}" ///                                                            
>                 avg_14k = "{bf:Average}" ///                                                            
>                 avg_24k = "{bf:Average}" ///                                                            
>                 avg_all = "{bf:Average}" ///                                                            
>                 )

. 
. * Add column titles     
. addplot 1: , title("{bf:RW}", size(med)) norescaling
(note:  named style med not found in class gsize, default attributes used)

. addplot 2: , title("{bf:IPS}") norescaling

. addplot 3: , title("{bf:FSR}") norescaling

. addplot 4: , title("{bf:14k}") norescaling

. addplot 5: , title("{bf:24k}") norescaling

. 
. * graph margin
. gr_edit .style.editstyle margin(left) editcopy 

. * plot margin
. gr_edit .plotregion1.style.editstyle margin(left) editcopy

. * Remove ylabel ticks
. gr_edit .plotregion1.yaxis1[5].style.editstyle majorstyle(tickstyle(show_ticks(no))) editcopy

. * Shift labels to left
. gr_edit .plotregion1.move yaxis1[5] leftof 9 1

. 
. * reset margins back to zero to flush with new col of labels
. gr_edit .style.editstyle margin(zero) editcopy 

. gr_edit .plotregion1.style.editstyle margin(zero) editcopy

. 
. graph export "$figsavedir/partisan-gap-by-item-arm.pdf", replace        
(file D:/partisan-gaps/figs/partisan-gap-by-item-arm.pdf written in PDF format)

. 
. 
. * sort(, descending) /// sort by coeff size (by first column) 
> *       transform(* = min(max(@,-.25),.5)) /// truncate CI, 1st num is lower bound, 2nd num is upper bound

end of do-file

. 
. // *** Balance tests (24k vs RW), takes a while
. do ./mturk/baltest-24k-rw.do

. preserve

. 
. drop if (question_type!="24k") & (question_type!="RW")
(725 observations deleted)

. gen tarm = (question_type=="24k") 

. 
. 
. global bs_seed 0

. global nboot 10000

. 
. cap program drop run_reg_corr

. program define run_reg_corr
  1.         args xvar
  2. 
.         qui eststo: reg tarm `xvar', vce(hc3) 
  3.         global `xvar'_N = "(N=`e(N)')"
  4.         
.         rho_report tarm `xvar', seed($bs_seed) nboot($nboot)
  5.         global `xvar'_rreport = "`r(rreport)'"
  6. end

. 
. *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
. *** Run regressions and correlation
. 
. center age interest_1 vote_1 pid_strength_1, standardize inplace
(modified variables: age interest_1 vote_1 pid_strength_1)

. qui tabulate educ, gen(d_educ)

. local listofxvar female age hisla d_educ2 d_educ5 d_educ1 d_educ4 asian black white interest_1 vote_1 pid_strength_1

. 
. eststo clear 

. local i = 1

. foreach xvar of varlist `listofxvar' {
  2.         _dots `i++' 0
  3.         run_reg_corr `xvar'
  4. }
.............
. 
. *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
. *** Plot
. grstyle init

. grstyle set plain, noextend

. 
. #delimit; 
delimiter now ;
. coefplot est*,
>         mcolor(navy) msize(small) 
>         ciopts(lcolor(gs7))
>         keep(`listofxvar')               
>         eqrename(est1="Female $female_N $female_rreport"
>                          est2="Age cohort $age_N $age_rreport"
>                          est3="Hispanic/Latinx $hisla_N   $hisla_rreport"
>                          // est4="No HS diploma `d_educ3_N' `d_educ3_rreport'"
>                          est4="HS diploma $d_educ2_N $d_educ2_rreport"
>                          est5="Some college $d_educ5_N $d_educ5_rreport"
>                          est6="Four-year college $d_educ1_N $d_educ1_rreport"
>                          est7="Post-graduate $d_educ4_N $d_educ4_rreport"
>                          est8="Asian $asian_N $asian_rreport"
>                          est9="Black $black_N $black_rreport"
>                          est10="White $white_N $white_rreport"
>                          // est11="Others `others_N' `others_rreport'"
>                          est11="Political interest $interest_1_N $interest_1_rreport"
>                          est12="Intention to vote $vote_1_N $vote_1_rreport"
>                          est13="Political leaning $pid_strength_1_N $pid_strength_1_rreport"
>                          )
>         headings(
>                 "HS diploma $d_educ2_N $d_educ2_rreport"="{bf:Education}"
>                 "Asian $asian_N $asian_rreport"="{bf:Race}"
>                 "Political interest $interest_1_N $interest_1_rreport"="{bf:Politics}", 
>                 labsize(vsmall) labgap(-3.5)
>                 )
>         asequation /// "set equation to model name or string" make the rows the models
>         swapnames /// "swap coefficient names and equation names"
>         xline(0, lcolor(gs10) lpattern(dash) lwidth(medium)) ///
>         ytick(none) /// remove horizontal grids 
>         ylabel(, labsize(vsmall))
>         xlabel(-.3(.1).3, labsize(vsmall))
>         // transform(* = min(max(@,-.24),.24)) /// truncate CI, 1st num is lower bound, 2nd num is upper bound  
>         yscale(noline alt)
>         plotregion(margin(0 1 0 0) ) ///        
>         graphregion(margin(3 0 0 0)) ///        
>         title("{bf:Pearson Correlation}" "{bf:Coefficient [95% CI]}", 
>                         position(11) justification(center) size(small)
>                 )
>         legend(off)
> ;

. #delimit cr
delimiter now cr
. 
. gr_edit .yaxis1.style.editstyle majorstyle(tickstyle(show_ticks(no))) editcopy // yaxis1 edits

. 
. gr_edit .move yaxis1 leftof 8 5 // yaxis1 grid reposition

. 
. gr_edit .yaxis1.edit_tick 1 1   `"{bf:{fontface Consolas:Female $female_N              $female_rreport}}"', tickset(ma
> jor)

. gr_edit .yaxis1.edit_tick 2 2   `"{bf:{fontface Consolas:Age cohort $age_N           $age_rreport}}"', tickset(major)

. gr_edit .yaxis1.edit_tick 3 3   `"{bf:{fontface Consolas:Hispanic/Latinx $hisla_N      $hisla_rreport}}"', tickset(maj
> or)

. gr_edit .yaxis1.edit_tick 4 6   `"{bf:{fontface Consolas:HS diploma $d_educ2_N           $d_educ2_rreport}}"', tickset
> (major)

. gr_edit .yaxis1.edit_tick 5 7   `"{bf:{fontface Consolas:Some college $d_educ5_N        $d_educ5_rreport}}"', tickset(
> major)

. gr_edit .yaxis1.edit_tick 6 8   `"{bf:{fontface Consolas:Four-year college $d_educ1_N    $d_educ1_rreport}}"', tickset
> (major)

. gr_edit .yaxis1.edit_tick 7 9   `"{bf:{fontface Consolas:Post-graduate $d_educ4_N       $d_educ4_rreport}}"', tickset(
> major)

. gr_edit .yaxis1.edit_tick 8 12  `"{bf:{fontface Consolas:Asian $asian_N                $asian_rreport}}"', tickset(maj
> or)

. gr_edit .yaxis1.edit_tick 9 13  `"{bf:{fontface Consolas:Black $black_N               $black_rreport}}"', tickset(majo
> r)

. gr_edit .yaxis1.edit_tick 10 14 `"{bf:{fontface Consolas:White $white_N               $white_rreport}}"', tickset(majo
> r)

. // gr_edit .yaxis1.edit_tick 11 15 `"Others                   0.07 (-0.03 to 0.17)"', tickset(major)
. gr_edit .yaxis1.edit_tick 11 17 `"{bf:{fontface Consolas:Political interest $interest_1_N  $interest_1_rreport}}"', ti
> ckset(major)

. gr_edit .yaxis1.edit_tick 12 18 `"{bf:{fontface Consolas:Intention to vote $vote_1_N   $vote_1_rreport}}"', tickset(ma
> jor)

. gr_edit .yaxis1.edit_tick 13 19 `"{bf:{fontface Consolas:Political leaning $pid_strength_1_N   $pid_strength_1_rreport
> }}"', tickset(major)

. 
. gr_edit .title.DragBy 0 -31

. 
. graph export $figsavedir/baltest-24k-rw.pdf, replace    
(file D:/partisan-gaps/figs/baltest-24k-rw.pdf written in PDF format)

. 
. restore

. 
end of do-file

. 
. **** Reg results for effect of party & survey type on response
. do ./mturk/reg-table.do

. 
. * Reshape from wide to long to stack participant-item observations
. foreach item of varlist $items {
  2.         rename `item' item`item'
  3. }

. reshape long item, i(id) j(item_type, string)
(note: j = birth death deficit fraud illegal increase mmr religion science)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                     1207   ->   10863
Number of variables                 406   ->     399
j variable (9 values)                     ->   item_type
xij variables:
    itembirth itemdeath ... itemscience   ->   item
-----------------------------------------------------------------------------

. 
. drop if pid_str=="Independent"
(3708 observations deleted)

. 
. 
. local spec1 i.rep

. local spec2 i.survey

. local spec3 i.rep##i.survey

. local spec4 `spec1' $demo

. local spec5 `spec2' $demo

. local spec6 `spec3' $demo

. 
. eststo clear

. forvalues i = 1/6 {
  2. eststo: qui reghdfe item `spec`i'', absorb(item_type) vce(cluster id)
  3.         estadd local items 9
  4.         estadd local Nrespondents = e(N_clust1)
  5.         local nobs: display %9.0fc `e(N)'
  6.         estadd local itemFE "\multicolumn{1}{c}{Yes}"
  7.         estadd local nobs "`nobs'"
  8.         if `i' > 3 {
  9.                 estadd local demo "\multicolumn{1}{c}{Yes}"
 10.         }
 11.         else {
 12.                 estadd local demo "\multicolumn{1}{c}{.}"       
 13.         }
 14. }
(est1 stored)

added macro:
              e(items) : "9"

added macro:
       e(Nrespondents) : "794"

added macro:
             e(itemFE) : "\multicolumn{1}{c}{Yes}"

added macro:
               e(nobs) : "    6,893"

added macro:
               e(demo) : "\multicolumn{1}{c}{.}"
(est2 stored)

added macro:
              e(items) : "9"

added macro:
       e(Nrespondents) : "794"

added macro:
             e(itemFE) : "\multicolumn{1}{c}{Yes}"

added macro:
               e(nobs) : "    6,893"

added macro:
               e(demo) : "\multicolumn{1}{c}{.}"
(est3 stored)

added macro:
              e(items) : "9"

added macro:
       e(Nrespondents) : "794"

added macro:
             e(itemFE) : "\multicolumn{1}{c}{Yes}"

added macro:
               e(nobs) : "    6,893"

added macro:
               e(demo) : "\multicolumn{1}{c}{.}"
(est4 stored)

added macro:
              e(items) : "9"

added macro:
       e(Nrespondents) : "793"

added macro:
             e(itemFE) : "\multicolumn{1}{c}{Yes}"

added macro:
               e(nobs) : "    6,884"

added macro:
               e(demo) : "\multicolumn{1}{c}{Yes}"
(est5 stored)

added macro:
              e(items) : "9"

added macro:
       e(Nrespondents) : "793"

added macro:
             e(itemFE) : "\multicolumn{1}{c}{Yes}"

added macro:
               e(nobs) : "    6,884"

added macro:
               e(demo) : "\multicolumn{1}{c}{Yes}"
(est6 stored)

added macro:
              e(items) : "9"

added macro:
       e(Nrespondents) : "793"

added macro:
             e(itemFE) : "\multicolumn{1}{c}{Yes}"

added macro:
               e(nobs) : "    6,884"

added macro:
               e(demo) : "\multicolumn{1}{c}{Yes}"

. 
. 
. #delimit;
delimiter now ;
. esttab,
>         b(%9.3fc)
>         se(%9.3fc)
>         varwidth(20)
>         modelwidth(8)   
>         star (+ 0.1 * 0.05 ** 0.01 *** 0.001)
>         keep(1.rep *.survey _cons)
>         obslast
>         label
>         nobase  
>         noobs
>         nomtitle
>         coeflabel(1.rep "Republican=1"
>                       1.rep#1.survey "Republican=1 $\times$ 14k"                
>                       1.rep#2.survey "Republican=1 $\times$ 24k"
>                       1.rep#3.survey "Republican=1 $\times$ FSR"
>                       1.rep#4.survey "Republican=1 $\times$ IPS"
>                 )
>         scalar(
>                 "r2 R$^2$" 
>                 "itemFE Survey item FE"
>                 "demo Demographic controls"
>                 "items Items"
>                 "Nrespondents Respondents"
>                 "nobs Respondent-items"
>                 ) 
>         title("Dep. var. is 1(response is congenial)")
> ;

Dep. var. is 1(response is congenial)
--------------------------------------------------------------------------------------------
                          (1)         (2)         (3)         (4)         (5)         (6)   
--------------------------------------------------------------------------------------------
Republican=1            0.256***                0.375***    0.258***                0.374***
                      (0.016)                 (0.030)     (0.016)                 (0.029)   

14k                                -0.090***   -0.023                  -0.093***   -0.026   
                                  (0.025)     (0.022)                 (0.025)     (0.021)   

24k                                -0.165***   -0.064***               -0.166***   -0.066***
                                  (0.022)     (0.018)                 (0.022)     (0.017)   

FSR                                -0.074**    -0.000                  -0.075**    -0.004   
                                  (0.025)     (0.022)                 (0.024)     (0.021)   

IPS                                -0.010      -0.000                  -0.014      -0.005   
                                  (0.028)     (0.022)                 (0.028)     (0.021)   

Republican=1 $\t~14k                           -0.156***                           -0.157***
                                              (0.044)                             (0.044)   

Republican=1 $\t~24k                           -0.265***                           -0.266***
                                              (0.042)                             (0.041)   

Republican=1 $\tim~R                           -0.196***                           -0.186***
                                              (0.042)                             (0.041)   

Republican=1 $\tim~S                           -0.024                              -0.021   
                                              (0.046)                             (0.045)   

Constant                0.165***    0.314***    0.182***   -0.008       1.794+      0.483   
                      (0.006)     (0.020)     (0.017)     (0.946)     (1.083)     (0.878)   
--------------------------------------------------------------------------------------------
R$^2$                   0.329       0.270       0.354       0.335       0.277       0.361   
Survey item FE       \multicolumn{1}{c}{Yes}    \multicolumn{1}{c}{Yes}    \multicolumn{1}{c}{Yes}    \multicolumn{1}{c}
> {Yes}    \multicolumn{1}{c}{Yes}    \multicolumn{1}{c}{Yes}   
Demographic controls \multicolumn{1}{c}{.}    \multicolumn{1}{c}{.}    \multicolumn{1}{c}{.}    \multicolumn{1}{c}{Yes} 
>    \multicolumn{1}{c}{Yes}    \multicolumn{1}{c}{Yes}   
Items                       9           9           9           9           9           9   
Respondents               794         794         794         793         793         793   
Respondent-items         6,893        6,893        6,893        6,884        6,884        6,884   
--------------------------------------------------------------------------------------------
Standard errors in parentheses
+ p<0.1, * p<0.05, ** p<0.01, *** p<0.001

.         esttab using $tabsavedir/mturk-reg-table-fragment.tex, 
>         b(%9.3fc)
>         se(%9.3fc)
>         varwidth(20)
>         modelwidth(8)   
>         star (+ 0.1 * 0.05 ** 0.01 *** 0.001)
>         keep(1.rep *.survey _cons)
>         obslast
>         label
>         nobase  
>         noobs
>         nomtitle
>         coeflabel(1.rep "Republican=1"
>                       1.rep#1.survey "Republican=1 $\times$ 14k"                
>                       1.rep#2.survey "Republican=1 $\times$ 24k"
>                       1.rep#3.survey "Republican=1 $\times$ FSR"
>                       1.rep#4.survey "Republican=1 $\times$ IPS"
>                 )
>         scalar(
>                 "r2 R$^2$" 
>                 "itemFE Survey item FE"
>                 "demo Demographic controls"
>                 "items Items"
>                 "Nrespondents Respondents"
>                 "nobs Respondent-items"
>                 ) 
>         alignment(D{.}{.}{-1})
>         substitute(\_ _)
>         fragment booktabs replace        
>         ;
(output written to D:/partisan-gaps/tabs/mturk-reg-table-fragment.tex)

. #delimit cr     
delimiter now cr
. 
end of do-file

. do ./mturk/barplot.do

. local rootdir D:/partisan-gaps // for my convenience to set project root dir, comment out to avoid conflict

. cd `rootdir'
D:\partisan-gaps

. cd scripts/Stata
D:\partisan-gaps\scripts\Stata

. **** Basic prep of data
. import delimited `rootdir'/data/turk/mturk-recoded.csv, clear
(344 vars, 1253 obs)

. do ./mturk/preamble.do

. global items    birth religion illegal death increase science fraud mmr deficit

. global arms             RW IPS FSR 14k 24k

. global demo     age i.female i.educ i.hisla $races

. 
. rename v1 id

. label var id "Participant ID"

. 
. rename avg avg_str

. destring avg_str, gen(avg) force
avg_str contains nonnumeric characters; avg generated as double
(2 missing values generated)

. 
. *------------------------------------------------------------------------------
. *** Response for the 9 items
. label define itemResponseLabel 1 "Correct" 0 "Incorrect"

. 
. foreach var of varlist $items {
  2.         tempvar _`var'
  3.         gen `_`var'' = `var'
  4.         drop `var'
  5.         gen `var' = (`_`var''=="TRUE") if (`_`var''!="NA")
  6.         label variable `var' "=1 if response is congenial to party for `var' item"
  7.         label values `var' itemResponseLabel
  8. }
(24 missing values generated)
(35 missing values generated)
(113 missing values generated)
(115 missing values generated)
(18 missing values generated)
(12 missing values generated)
(18 missing values generated)
(31 missing values generated)
(82 missing values generated)

. 
. replace deficit = 1 - deficit
(1171 real changes made)

. 
. *------------------------------------------------------------------------------
. *** pid
. rename pid pid_str

. drop if pid_str =="Something else"
(46 observations deleted)

. 
. label define pidLabel 1 "Democrat" 2 "Independent" 3 "Republican"

. encode pid_str, gen(pid) label(pidLabel)

. 
. fvset base 2 pid // permanently set Independent as base

. 
. gen rep = (pid_str=="Republican") if !missing(pid_str)

. 
. *------------------------------------------------------------------------------
. *** Demo
. rename gender gender_str

. label define genderLabel 0 "Male" 1 "Female"

. encode gender_str, gen(female) label(genderLabel)

. 
. foreach demo in educ hisla race {
  2.         rename `demo' `demo'_str
  3.         encode `demo'_str, gen(`demo')
  4. }

. 
. gen asian = strmatch(race_str, "Asian*")

. gen black = strmatch(race_str, "Black*")

. gen white = strmatch(race_str, "White*")

. gen others = strmatch(race_str, "Other*")

. global races asian black white others

. 
. *------------------------------------------------------------------------------
. *** Survey types
. encode question_type, gen(survey)

. fvset base 5 survey // permanently set RW as base

. 
end of do-file

. 
. * Reshape from wide to long to stack participant-item observations
. foreach item of varlist $items {
  2.         rename `item' item`item'
  3. }

. reshape long item, i(id) j(item_type, string)
(note: j = birth death deficit fraud illegal increase mmr religion science)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                     1207   ->   10863
Number of variables                 356   ->     349
j variable (9 values)                     ->   item_type
xij variables:
    itembirth itemdeath ... itemscience   ->   item
-----------------------------------------------------------------------------

. 
. drop if pid_str=="Independent"
(3708 observations deleted)

. 
. eststo: qui reghdfe item i.rep##i.survey $demo, absorb(item_type) vce(cluster id)
(est7 stored)

. 
. mat coefmat = e(b)

. mat list coefmat

coefmat[1,32]
            0b.          1.          1.          2.          3.          4.         5b.     0b.rep#     0b.rep#
           rep         rep      survey      survey      survey      survey      survey   1o.survey   2o.survey
y1           0   .38351127  -.02260659  -.06382917   -.0037427  -.00360187           0           0           0

        0b.rep#     0b.rep#     0b.rep#      1.rep#      1.rep#      1.rep#      1.rep#     1o.rep#            
     3o.survey   4o.survey   5b.survey    1.survey    2.survey    3.survey    4.survey   5b.survey         age
y1           0           0           0   -.1569754  -.26645049  -.18803882  -.02275678           0  -.00028675

            0b.          1.         1b.          2.          3.          4.          5.         1b.          2.
        female      female        educ        educ        educ        educ        educ       hisla       hisla
y1           0   .01730912           0    .0243345   .24794014   -.0294332   .02978312           0   .00281798

                                                               
         asian       black       white      others       _cons
y1  -.07846987  -.03329282  -.09986147  -.06673277   .82192409

. local baseline = coefmat[1, 2] /* 1.rep */

. 
. // preserve
. regsave

. drop if var=="_cons"
(1 observation deleted)

. drop if strpos(var, "0b.rep")
(6 observations deleted)

. drop if var=="1.survey"
(1 observation deleted)

. drop if var=="2.survey"
(1 observation deleted)

. drop if var=="3.survey"
(1 observation deleted)

. drop if var=="4.survey"
(1 observation deleted)

. drop if var=="5b.survey"
(1 observation deleted)

. drop if var=="1o.rep#5b.survey"
(1 observation deleted)

. drop if strpos(var, "female")
(2 observations deleted)

. drop if strpos(var, "educ")
(5 observations deleted)

. drop if strpos(var, "hisla")
(2 observations deleted)

. drop if var=="age"
(1 observation deleted)

. drop if var=="asian"
(1 observation deleted)

. drop if var=="black"
(1 observation deleted)

. drop if var=="white"
(1 observation deleted)

. drop if var=="others"
(1 observation deleted)

. 
. * Gen coef for plotting (add estimates back to baseline)
. gen est = coef

. label var est "Original reg estimate (before adding back to baseline)"

. replace coef = `baseline' + coef if var!="1.rep"
(4 real changes made)

. 
. * Construct CI
. gen uci = coef + 1.96 * stderr

. gen lci = coef - 1.96 * stderr

. replace uci = 0 if var=="_cons"
(0 real changes made)

. replace lci = 0 if var=="_cons"
(0 real changes made)

. 
. 
. * Create plot order var by treat dummies and label values with sample size
. gen porder = _n

. replace porder = 0 if var=="_cons"
(0 real changes made)

. sort porder

. 
. label define xlab 1 "RW" 2 "14k" 3 "24k" 4 "FSR" 5 "IPS"

. label values porder xlab

. *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
. * Graph settings
. set scheme s2mono

. local YLAB_OPTS angle(horizontal) labsize(large) nogrid

. local YRANGE 0.1(0.1).4

. local BASELINE_XLIM = _N+.5

. local CI_WIDTH medthick

. local XLAB_SIZE large

. local BAR_OPTS          color(purple) fcolor(none) lwidth(medthick)

. local BAR_OPTS_BASE color(gs5) fcolor(none) lwidth(medthick)

. 
. local graphsavedir ./figures

. *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
. 
. #delimit;
delimiter now ;
.         twoway  
>                         (bar coef porder if porder==1, `BAR_OPTS_BASE') 
>                         (bar coef porder if porder==2, `BAR_OPTS') 
>                         (bar coef porder if porder==3, `BAR_OPTS') 
>                         (bar coef porder if porder==4, `BAR_OPTS') 
>                         (bar coef porder if porder==5, `BAR_OPTS'
>                                 xlabel(,val labsize(`XLAB_SIZE') )
>                         ) 
>                         (rcap uci lci porder if porder!=1, 
>                                 color(black)
>                                 lwidth(`CI_WIDTH')
>                                 legend(off)
>                                 ylabel(`YRANGE', `YLAB_OPTS' ) 
>                                 xlabel(, notick)
>                                 xscale(noextend lcolor(none))
>                                 graphregion(color(white) lc(white) lw(medium) margin(0 0 0 0)) 
>                                 bgcolor(white)
>                                 plotregion(margin(12 12 0 0))
>                         )               
>                         (scatteri `baseline' .5 `baseline' `BASELINE_XLIM', 
>                                 xlabel(1 2 3 4 5)
>                                 recast(line) color(black) lpattern(dash)
>                         )
>                 ;

.         #delimit cr     
delimiter now cr
. graph export $figsavedir/mturk-pgag-surveyarms.pdf, replace     
(file D:/partisan-gaps/figs/mturk-pgag-surveyarms.pdf written in PDF format)

. 
end of do-file

. 
. 
. *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
. * YouGov results
. *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
. **** Basic prep of data
. import delimited D:/partisan-gaps/data/survey_exp/selex.csv, clear
(262 vars, 2500 obs)

. do ./survey-exp/preamble.do

. **** Basic prep of data
. import delimited D:/partisan-gaps/data/survey_exp/selex.csv, clear
(262 vars, 2500 obs)

. 
. gen rep = (pid2=="Republican")

. gen dem = (pid2=="Democrat")

. gen ind = (pid3=="Independent")

. encode pid3, gen(partisanship)

. 
. /* Unemployment (qpk7)
> Unemployment rate since the 2010 midterm elections ...
> 
> Count Code Label
> ----- ---- -----
> 690 1 Gone Up
> 675 2 Remained the same
> 847 3 Gone Down
> 242 4 Can't Say
> 46 8 Skipped
> 0 9 Not Asked
> */
. gen unempup = (qpk7=="Gone Up") 

. label var unempup "Responded that unempployment has gone up"

. 
. /* Unemployment (qpk7)
> Budget deficit since the 2010 midterm elections ...
> 
> Count Code Label
> ----- ---- -----
> 1576 1 Gone Up
> 441 2 Remained the same
> 160 3 Gone Down
> 284 4 Can't Say
> 39 8 Skipped
> 0 9 Not Asked
> */
. gen deficitup = (qpk8=="Gone Up")

. label var deficitup "Responded that budget deficit has gone up"

. 
. 
. /* Partisan cue (qpk7_insert)
> when Democrats retained control of  the Senate
> when Republicans regained control of the US Cong
> */
. gen repcue = (strpos(qpk7_insert, "Rep")>0)

. label var repcue "=1 if Republican cue"

. 
. 
. /* Demographics*/
. global demoX birthyr i.gender i.white i.educ i.marstat i.employ newsint i.faminc

. 
. rename gender gender_str

. encode gender_str, gen(gender)

. 
. encode race, gen(white)

. 
. rename educ educ_str

. encode educ_str, gen(educ)

. 
. rename marstat marstat_str

. encode marstat_str, gen(marstat)

. 
. rename employ employ_str

. encode employ_str, gen(employ)

. 
. rename faminc faminc_str

. encode faminc_str, gen(faminc)

. 
. 
. /* Congenial cues 
> Cue is congenial when the cue makes a partisan more likely to get the correct response (unemp went up)
> This is when:
>         * a R sees a D cue
>         * a D sees a R cue
> */
. gen congenialcue = (rep==1 & repcue==0) | (dem==1 & repcue==1)

. gen uncongenialcue = (rep==1 & repcue==1) | (dem==1 & repcue==0)

. 
end of do-file

. drop if ind==1
(396 observations deleted)

. 
. **** Reg table for effect of party & survey type on response
. do ./survey-exp/reg-table.do

. eststo clear

. eststo: qui reg unempup i.congenialcue, vce(hc3)
(est1 stored)

.         local nobs: display %9.0fc `e(N)'

.         estadd local nobs "\multicolumn{1}{c}{`nobs'}"

added macro:
               e(nobs) : "\multicolumn{1}{c}{    2,104}"

.         estadd local demotab "\multicolumn{1}{c}{.}"

added macro:
            e(demotab) : "\multicolumn{1}{c}{.}"

. 
. eststo: qui reg unempup i.congenialcue##i.rep, vce(hc3)
(est2 stored)

.         local nobs: display %9.0fc `e(N)'

.         estadd local nobs "\multicolumn{1}{c}{`nobs'}"

added macro:
               e(nobs) : "\multicolumn{1}{c}{    2,104}"

.         estadd local demotab "\multicolumn{1}{c}{.}"

added macro:
            e(demotab) : "\multicolumn{1}{c}{.}"

. 
. eststo: qui reg unempup i.congenialcue##i.rep $demoX, vce(hc3)
(est3 stored)

.         local nobs: display %9.0fc `e(N)'

.         estadd local nobs "\multicolumn{1}{c}{`nobs'}"

added macro:
               e(nobs) : "\multicolumn{1}{c}{    2,066}"

.         estadd local demotab "\multicolumn{1}{c}{Yes}"

added macro:
            e(demotab) : "\multicolumn{1}{c}{Yes}"

.         estadd local demo "Yes"

added macro:
               e(demo) : "Yes"

. 
. eststo: qui reg deficitup i.congenialcue, vce(hc3)
(est4 stored)

.         local nobs: display %9.0fc `e(N)'

.         estadd local nobs "\multicolumn{1}{c}{`nobs'}"

added macro:
               e(nobs) : "\multicolumn{1}{c}{    2,104}"

.         estadd local demotab "\multicolumn{1}{c}{.}"

added macro:
            e(demotab) : "\multicolumn{1}{c}{.}"

. 
. eststo: qui reg deficitup i.congenialcue##i.rep, vce(hc3)
(est5 stored)

.         local nobs: display %9.0fc `e(N)'

.         estadd local nobs "\multicolumn{1}{c}{`nobs'}"

added macro:
               e(nobs) : "\multicolumn{1}{c}{    2,104}"

.         estadd local demotab "\multicolumn{1}{c}{.}"

added macro:
            e(demotab) : "\multicolumn{1}{c}{.}"

. 
. eststo: qui reg deficitup i.congenialcue##i.rep $demoX, vce(hc3)
(est6 stored)

.         local nobs: display %9.0fc `e(N)'

.         estadd local nobs "\multicolumn{1}{c}{`nobs'}"

added macro:
               e(nobs) : "\multicolumn{1}{c}{    2,066}"

.         estadd local demotab "\multicolumn{1}{c}{Yes}"

added macro:
            e(demotab) : "\multicolumn{1}{c}{Yes}"

.         estadd local demo "Yes" 

added macro:
               e(demo) : "Yes"

. 
. #delimit;
delimiter now ;
. esttab,
>         b(%9.3fc)
>         se(%9.3fc)
>         varwidth(30)
>         modelwidth(8)   
>         star (+ 0.1 * 0.05 ** 0.01 *** 0.001)
>         keep(1.congenialcue 1.rep 1.congenialcue#1.rep _cons)
>         obslast
>         label
>         nobase  
>         nomtitle
>         coeflabel(1.congenialcue "Congenial cue"
>                           1.rep "Republican"
>                       1.congenialcue#1.rep "Congenial cue x Republican"         
>                 )
>         scalar(
>                 "demo Demographic controls"
>                 "r2 R-square" 
>                 ) 
>         // title("Dep. var. is 1(response is congenial)")
> ;

------------------------------------------------------------------------------------------------------
                                    (1)         (2)         (3)         (4)         (5)         (6)   
------------------------------------------------------------------------------------------------------
Congenial cue                     0.144***    0.111***    0.112***    0.178***    0.182***    0.190***
                                (0.019)     (0.025)     (0.026)     (0.021)     (0.030)     (0.029)   

Republican                                    0.067**     0.071**                 0.232***    0.162***
                                            (0.025)     (0.027)                 (0.030)     (0.031)   

Congenial cue x Republican                    0.069+      0.071+                 -0.009      -0.009   
                                            (0.038)     (0.039)                 (0.040)     (0.039)   

Constant                          0.199***    0.168***    3.170+      0.552***    0.443***    7.056***
                                (0.012)     (0.016)     (1.874)     (0.015)     (0.021)     (1.837)   
------------------------------------------------------------------------------------------------------
Demographic controls                                        Yes                                 Yes   
R-square                          0.026       0.041       0.069       0.035       0.090       0.190   
Observations                       2104        2104        2066        2104        2104        2066   
------------------------------------------------------------------------------------------------------
Standard errors in parentheses
+ p<0.1, * p<0.05, ** p<0.01, *** p<0.001

.         esttab using $tabsavedir/yougov-reg-table-fragment.tex, 
>         b(%9.3fc)
>         se(%9.3fc)
>         varwidth(20)
>         modelwidth(8)   
>         star (+ 0.1 * 0.05 ** 0.01 *** 0.001)
>         keep(1.congenialcue 1.rep 1.congenialcue#1.rep _cons)
>         obslast
>         label
>         nobase  
>         noobs
>         nomtitle
>         coeflabel(1.congenialcue "Congenial cue"
>                           1.rep "Republican"
>                       1.congenialcue#1.rep "Congenial cue $\times$ Republican"          
>                       _cons "Constant"  
>                 )
>         scalar(
>                 "r2 R$^2$" 
>                 "demotab Demographic controls"
>                 "nobs Respondent-items"
>                 ) 
>         alignment(D{.}{.}{-1})
>         substitute(\_ _)
>         fragment booktabs replace        
>         ;
(output written to D:/partisan-gaps/tabs/yougov-reg-table-fragment.tex)

. #delimit cr     
delimiter now cr
. 
end of do-file

. 
. **** Barplots for effect of party & survey type on response
. do ./survey-exp/unemp-barplots.do

. qui reg unempup i.congenialcue, vce(hc3)

. 
. mat coefmat = e(b)

. mat list coefmat

coefmat[1,3]
              0b.            1.              
    congenialcue  congenialcue         _cons
y1             0     .14400665     .19903846

. local baseline = coefmat[1, 3] /* _cons */

. local repcoef = coefmat[1,2]  /* 1.congenialcue */

. 
. preserve

. regsave

. drop if coef==0
(1 observation deleted)

. 
. gen effect = `baseline' + coef if var!="_cons"
(1 missing value generated)

. replace effect = `baseline' if var=="_cons"
(1 real change made)

. 
. * Construct CI
. gen uci = effect + 1.96 * stderr

. gen lci = effect - 1.96 * stderr

. replace uci = 0 if var=="_cons"
(1 real change made)

. replace lci = 0 if var=="_cons"
(1 real change made)

. 
. gen porder = 0 if var=="_cons"
(1 missing value generated)

. replace porder = 1 if var=="1.congenialcue"
(1 real change made)

. sort porder

. 
. *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
. * Graph settings
. label define xlab 0 `""Uncongenial" "cue""' 1 `""Congenial" "cue""'

. label values porder xlab

. 
. set scheme s2mono

. local YLAB_OPTS angle(horizontal) labsize(large) nogrid 

. local YRANGE 0.(0.1).4

. local BASELINE_XLIM = _N+.5

. local CI_WIDTH medthick

. local XLAB_SIZE large

. local BAR_OPTS          color(gs7) fcolor(none) lwidth(thick)

. *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
. #delimit;
delimiter now ;
. twoway  
>                 (bar effect porder if porder==0, `BAR_OPTS') 
>                 (bar effect porder if porder==1, `BAR_OPTS'
>                         xlabel(,val labsize(`XLAB_SIZE') )
>                         xtitle("")
>                 ) 
>                 (rcap uci lci porder if porder!=0, 
>                         color(black)
>                         lwidth(`CI_WIDTH')
>                         legend(off)
>                         ylabel(`YRANGE', `YLAB_OPTS' ) 
>                         yscale(r(0 .41))
>                         xlabel(0 1,val labsize(`XLAB_SIZE') noticks)
>                         xscale(noextend lcolor(none))
>                         graphregion(color(white) lc(white) lw(medium) margin(0 0 3 0)) 
>                         bgcolor(white)
>                         plotregion(margin(30 30 0 0))
>                 )               
>         ;

. #delimit cr     
delimiter now cr
. 
. graph export $figsavedir/yougov-unemp-congenialcue.pdf, replace 
(file D:/partisan-gaps/figs/yougov-unemp-congenialcue.pdf written in PDF format)

. restore

. 
. 
. *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
. *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
. * Congenial cue interacted with partisanship
. *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
. *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
. qui reg unempup i.congenialcue##i.rep, vce(hc3)

. 
. mat coefmat = e(b)

. mat list coefmat

coefmat[1,9]
               0b.             1.            0b.             1.  0b.congeni~e#  0b.congeni~e#  1o.congeni~e#
     congenialcue   congenialcue            rep            rep         0b.rep         1o.rep         0b.rep
y1              0      .11099402              0      .06663847              0              0              0

     1.congenia~e#               
            1.rep          _cons
y1      .06947264      .16757741

. local baseline = coefmat[1, 9] /* _cons */

. local congcoef = coefmat[1,2]  /* 1.congenialcue */

. local repcoef = coefmat[1,4]  /* 1.rep */

. 
. preserve

. regsave

. drop if coef==0
(5 observations deleted)

. 
. gen effect = `baseline' + coef if var!="_cons"
(1 missing value generated)

. replace effect = `baseline' if var=="_cons"
(1 real change made)

. replace effect = effect + `congcoef' + `repcoef' if var=="1.congenialcue#1.rep"
(1 real change made)

. 
. * Construct CI
. gen uci = effect + 1.96 * stderr

. gen lci = effect - 1.96 * stderr

. replace uci = 0 if var=="_cons"
(1 real change made)

. replace lci = 0 if var=="_cons"
(1 real change made)

. 
. gen porder = 0 if var=="_cons"
(3 missing values generated)

. replace porder = 1 if var=="1.congenialcue"
(1 real change made)

. replace porder = 2 if var=="1.rep"
(1 real change made)

. replace porder = 3 if var=="1.congenialcue#1.rep"
(1 real change made)

. sort porder

. 
. *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
. * Graph settings
. label define xlab 0 `""Dem. w/" "uncongenial" "cue""' 1 `""Dem. w/" "congenial" "cue""' 2 `""Rep. w/" "uncongenial" "c
> ue""' 3 `""Rep. w/" "congenial" "cue""' 

. label values porder xlab

. 
. set scheme s2mono

. local YLAB_OPTS angle(horizontal) labsize(large) nogrid 

. local YRANGE 0.(0.1).5

. local BASELINE_XLIM = _N+.5

. local CI_WIDTH medthick

. local XLAB_SIZE large

. local BAR_OPTS           fcolor(none) lwidth(thick)

. *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
. #delimit;
delimiter now ;
. twoway  
>                 (bar effect porder if porder==0, color(navy)   `BAR_OPTS') 
>                 (bar effect porder if porder==1, color(navy)   `BAR_OPTS') 
>                 (bar effect porder if porder==2, color(maroon) `BAR_OPTS') 
>                 (bar effect porder if porder==3, color(maroon) `BAR_OPTS'
>                         xlabel(,val labsize(`XLAB_SIZE') )
>                         xtitle("")
>                 ) 
>                 (rcap uci lci porder if porder!=0, 
>                         color(black)
>                         lwidth(`CI_WIDTH')
>                         legend(off)
>                         ylabel(`YRANGE', `YLAB_OPTS' ) 
>                         yscale(r(0 .51))
>                         xlabel(, notick)
>                         xscale(noextend lcolor(none))
>                         graphregion(color(white) lc(white) lw(medium) margin(0 0 10 0)) 
>                         bgcolor(white)
>                         plotregion(margin(12 12 0 0))
>                 )               
>         ;

. #delimit cr     
delimiter now cr
. graph export $figsavedir/yougov-unemp-congenialcue-partisan.pdf, replace        
(file D:/partisan-gaps/figs/yougov-unemp-congenialcue-partisan.pdf written in PDF format)

. 
. restore

. 
end of do-file

. do ./survey-exp/deficit-barplots.do

. qui reg deficitup i.congenialcue, vce(hc3)

. 
. mat coefmat = e(b)

. mat list coefmat

coefmat[1,3]
              0b.            1.              
    congenialcue  congenialcue         _cons
y1             0     .17834008     .55192308

. local baseline = coefmat[1, 3] /* _cons */

. local repcoef = coefmat[1,2]  /* 1.congenialcue */

. 
. preserve

. regsave

. drop if coef==0
(1 observation deleted)

. 
. gen effect = `baseline' + coef if var!="_cons"
(1 missing value generated)

. replace effect = `baseline' if var=="_cons"
(1 real change made)

. 
. * Construct CI
. gen uci = effect + 1.96 * stderr

. gen lci = effect - 1.96 * stderr

. replace uci = 0 if var=="_cons"
(1 real change made)

. replace lci = 0 if var=="_cons"
(1 real change made)

. 
. gen porder = 0 if var=="_cons"
(1 missing value generated)

. replace porder = 1 if var=="1.congenialcue"
(1 real change made)

. sort porder

. 
. *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
. * Graph settings
. label define xlab 0 `""Uncongenial" "cue""' 1 `""Congenial" "cue""'

. label values porder xlab

. 
. set scheme s2mono

. local YLAB_OPTS angle(horizontal) labsize(large) nogrid 

. local YRANGE 0.(0.2).8

. local BASELINE_XLIM = _N+.5

. local CI_WIDTH medthick

. local XLAB_SIZE large

. local BAR_OPTS          color(gs7) fcolor(none) lwidth(thick)

. *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
. #delimit;
delimiter now ;
. twoway  
>                 (bar effect porder if porder==0, `BAR_OPTS') 
>                 (bar effect porder if porder==1, `BAR_OPTS'
>                         xlabel(,val labsize(`XLAB_SIZE') )
>                         xtitle("")
>                 ) 
>                 (rcap uci lci porder if porder!=0, 
>                         color(black)
>                         lwidth(`CI_WIDTH')
>                         legend(off)
>                         ylabel(`YRANGE', `YLAB_OPTS' ) 
>                         yscale(r(0 .82))
>                         xlabel(0 1,val labsize(`XLAB_SIZE') noticks)
>                         xscale(noextend lcolor(none))
>                         graphregion(color(white) lc(white) lw(medium) margin(0 0 3 0)) 
>                         bgcolor(white)
>                         plotregion(margin(30 30 0 0))
>                 )               
>         ;

. #delimit cr     
delimiter now cr
. 
. graph export $figsavedir/yougov-deficit-congenialcue.pdf, replace       
(file D:/partisan-gaps/figs/yougov-deficit-congenialcue.pdf written in PDF format)

. restore

. 
. *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
. *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
. * Congenial cue interacted with partisanship
. *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
. *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
. qui reg deficitup i.congenialcue##i.rep, vce(hc3)

. 
. mat coefmat = e(b)

. mat list coefmat

coefmat[1,9]
               0b.             1.            0b.             1.  0b.congeni~e#  0b.congeni~e#  1o.congeni~e#
     congenialcue   congenialcue            rep            rep         0b.rep         1o.rep         0b.rep
y1              0      .18237705              0      .23151147              0              0              0

     1.congenia~e#               
            1.rep          _cons
y1     -.00928925      .44262295

. local baseline = coefmat[1, 9] /* _cons */

. local congcoef = coefmat[1,2]  /* 1.congenialcue */

. local repcoef = coefmat[1,4]  /* 1.rep */

. 
. preserve

. regsave

. drop if coef==0
(5 observations deleted)

. 
. gen effect = `baseline' + coef if var!="_cons"
(1 missing value generated)

. replace effect = `baseline' if var=="_cons"
(1 real change made)

. replace effect = effect + `congcoef' + `repcoef' if var=="1.congenialcue#1.rep"
(1 real change made)

. 
. * Construct CI
. gen uci = effect + 1.96 * stderr

. gen lci = effect - 1.96 * stderr

. replace uci = 0 if var=="_cons"
(1 real change made)

. replace lci = 0 if var=="_cons"
(1 real change made)

. 
. gen porder = 0 if var=="_cons"
(3 missing values generated)

. replace porder = 1 if var=="1.congenialcue"
(1 real change made)

. replace porder = 2 if var=="1.rep"
(1 real change made)

. replace porder = 3 if var=="1.congenialcue#1.rep"
(1 real change made)

. sort porder

. 
. *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
. * Graph settings
. label define xlab 0 `""Dem. w/" "uncongenial" "cue""' 1 `""Dem. w/" "congenial" "cue""' 2 `""Rep. w/" "uncongenial" "c
> ue""' 3 `""Rep. w/" "congenial" "cue""' 

. label values porder xlab

. 
. set scheme s2mono

. local YLAB_OPTS angle(horizontal) labsize(large) nogrid 

. local YRANGE 0.(0.2).8

. local BASELINE_XLIM = _N+.5

. local CI_WIDTH medthick

. local XLAB_SIZE large

. local BAR_OPTS           fcolor(none) lwidth(thick)

. *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
. #delimit;
delimiter now ;
. twoway  
>                 (bar effect porder if porder==0, color(navy)   `BAR_OPTS') 
>                 (bar effect porder if porder==1, color(navy)   `BAR_OPTS') 
>                 (bar effect porder if porder==2, color(maroon) `BAR_OPTS') 
>                 (bar effect porder if porder==3, color(maroon) `BAR_OPTS'
>                         xlabel(,val labsize(`XLAB_SIZE') )
>                         xtitle("")
>                 ) 
>                 (rcap uci lci porder if porder!=0, 
>                         color(black)
>                         lwidth(`CI_WIDTH')
>                         legend(off)
>                         ylabel(`YRANGE', `YLAB_OPTS' ) 
>                         yscale(r(0 .81))
>                         xlabel(, notick)
>                         xscale(noextend lcolor(none))
>                         graphregion(color(white) lc(white) lw(medium) margin(0 0 10 0)) 
>                         bgcolor(white)
>                         plotregion(margin(12 12 0 0))
>                 )               
>         ;

. #delimit cr     
delimiter now cr
. graph export $figsavedir/yougov-deficit-congenialcue-partisan.pdf, replace      
(file D:/partisan-gaps/figs/yougov-deficit-congenialcue-partisan.pdf written in PDF format)

. 
. restore

. 
end of do-file

. 
. 
. 
. tictoc toc
------------------------------------------------------------------------------------------------------------------------
----------- Time log -----------
Start time:  6 Apr 2022 16:08:42
End time:  6 Apr 2022 16:13:38
Elapsed seconds:       295
Elapsed minutes:         5
Elapsed hours:       .08
------------------------------------------------------------------------------------------------------------------------

. 
. log close
      name:  <unnamed>
       log:  D:\partisan-gaps\scripts\Stata\logs/partisan-gaps.txt
  log type:  text
 closed on:   6 Apr 2022, 16:13:38
------------------------------------------------------------------------------------------------------------------------
