------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  D:\partisan-gaps\scripts\Stata\logs/partisan-gaps.txt
  log type:  text
 opened on:   1 Dec 2021, 21:05:12

. 
. cls                                     // Clear results window

. version 13              // Still on version 13 :(

. clear all               // Start with a clean slate

. set more off            // Disable partitioned output

. macro drop _all         // Clear all macros to avoid namespace conflicts

. set linesize 120        // Line size limit to make output more readable, affects logs

. // local figsavedir ./out/figures       // Savepath for figures
. // local tabsavedir ./out/tables        // Savepath for tables
. adopath ++ ./ado                // Add path to ados
  [1]              "./ado"
  [2]  (BASE)      "C:\Program Files\Stata17\ado\base/"
  [3]  (SITE)      "C:\Program Files\Stata17\ado\site/"
  [4]              "."
  [5]  (PERSONAL)  "C:\Users\lsys\ado\personal/"
  [6]  (PLUS)      "C:\Users\lsys\ado\plus/"
  [7]  (OLDPLACE)  "c:\ado/"

. * -----------------------------------------------------------------------------
. tictoc tic
------------------------------------------------------------------------------------------------------------------------
----------- Time log -----------
Start time:  1 Dec 2021 21:05:13
------------------------------------------------------------------------------------------------------------------------

. 
. **** Basic prep of data
. import delimited D:/partisan-gaps/data/mturk-recoded.csv
(344 vars, 1,253 obs)

. do preamble.do

. global items    birth religion illegal death increase science fraud mmr deficit

. global arms             RW IPS FSR 14k 24k

. global demo     age i.female i.educ i.hisla $races

. 
. rename v1 id

. label var id "Participant ID"

. 
. rename avg avg_str

. destring avg_str, gen(avg) force
avg_str: contains nonnumeric bytes; avg generated as double
(2 missing values generated)

. 
. *------------------------------------------------------------------------------
. *** Response for the 9 items
. label define itemResponseLabel 1 "Correct" 0 "Incorrect"

. 
. foreach var of varlist $items {
  2.         tempvar _`var'
  3.         gen `_`var'' = `var'
  4.         drop `var'
  5.         gen `var' = (`_`var''=="TRUE") if (`_`var''!="NA")
  6.         label variable `var' "=1 if response is congenial to party for `var' item"
  7.         label values `var' itemResponseLabel
  8. }
(24 missing values generated)
(35 missing values generated)
(113 missing values generated)
(115 missing values generated)
(18 missing values generated)
(12 missing values generated)
(18 missing values generated)
(31 missing values generated)
(82 missing values generated)

. 
. replace deficit = 1 - deficit
(1,171 real changes made)

. 
. *------------------------------------------------------------------------------
. *** pid
. rename pid pid_str

. drop if pid_str =="Something else"
(46 observations deleted)

. 
. label define pidLabel 1 "Democrat" 2 "Independent" 3 "Republican"

. encode pid_str, gen(pid) label(pidLabel)

. 
. fvset base 2 pid // permanently set Independent as base

. 
. gen rep = (pid_str=="Republican") if !missing(pid_str)

. 
. *------------------------------------------------------------------------------
. *** Demo
. rename gender gender_str

. label define genderLabel 0 "Male" 1 "Female"

. encode gender_str, gen(female) label(genderLabel)

. 
. foreach demo in educ hisla race {
  2.         rename `demo' `demo'_str
  3.         encode `demo'_str, gen(`demo')
  4. }

. 
. gen asian = strmatch(race_str, "Asian*")

. gen black = strmatch(race_str, "Black*")

. gen white = strmatch(race_str, "White*")

. gen others = strmatch(race_str, "Other*")

. global races asian black white others

. 
. *------------------------------------------------------------------------------
. *** Survey types
. encode question_type, gen(survey)

. fvset base 5 survey // permanently set RW as base

. 
end of do-file

. 
. **** Figure for raw partisan gaps by items, by survey type
. do fig-partisan-gap.do

. grstyle init
Scheme _GRSTYLE_ already active although grstyle is not running
Press any key to reset default scheme to s2color and overwrite scheme _GRSTYLE_, or Break to abort
(set scheme preference recorded)

. grstyle set plain, 

. 
. eststo clear

. foreach item of varlist $items avg {
  2.         foreach arm in $arms {
  3.                 qui: reg `item' ib1.pid if (pid_str!="Independent") & (question_type=="`arm'"), vce(hc3)
  4.                 est store `item'_`arm'          
  5.         }
  6. 
.         // * For all arms together
.         // qui: reg `item' ib1.pid if (pid_str!="Independent") 
.         // est store `item'_all 
. }

. 
. 
. coefplot (*_RW) || (*_IPS) || (*_FSR) || (*_14k) || (*_24k), ///
>         msymbol(s) ///
>         keep(3.pid) ///
>         asequation /// "set equation to model name or string" make the rows the models
>         swapnames /// "swap coefficient names and equation names"
>         subtitle("") /// Remove subtitles for now
>         byopts(row(1)) /// Force results to be in one row (1xn)
>         xline(0, lcolor(gs10) lpattern(dash) lwidth(medium)) ///
>         xlabel(-.3(.3).6) ///
>         xscale(range(-.2 .53)) ///
>         plotregion(margin(zero) ) ///   
>         plotregion(lcolor(black) margin(zero) lwidth(medthin)) /// draw box around columns
>         graphregion(margin(zero)) ///
>         ytick(none) /// remove horizontal grids
>         yscale(noline alt)  /// swap labels to RHS
>         eqrename( ///
>                 birth_RW = "{bf:birth}" ///
>                 birth_IPS = "{bf:birth}" ///
>                 birth_FSR = "{bf:birth}" ///
>                 birth_14k = "{bf:birth}" ///
>                 birth_24k = "{bf:birth}" ///
>                 birth_all = "{bf:birth}" ///
>                 religion_RW = "{bf:religion}" ///                                                                     
>                               " ///
>                 religion_IPS = "{bf:religion}" ///
>                 religion_FSR = "{bf:religion}" ///
>                 religion_14k = "{bf:religion}" ///
>                 religion_24k = "{bf:religion}" ///
>                 religion_all = "{bf:religion}" ///
>                 illegal_RW = "{bf:illegal}" ///
>                 illegal_IPS = "{bf:illegal}" ///
>                 illegal_FSR = "{bf:illegal}" ///
>                 illegal_14k = "{bf:illegal}" ///
>                 illegal_24k = "{bf:illegal}" ///
>                 illegal_all = "{bf:illegal}" ///
>                 death_RW = "{bf:death}" ///
>                 death_IPS = "{bf:death}" ///
>                 death_FSR = "{bf:death}" ///
>                 death_14k = "{bf:death}" ///
>                 death_24k = "{bf:death}" ///
>                 death_all = "{bf:death}" ///
>                 increase_RW = "{bf:increase}" ///
>                 increase_IPS = "{bf:increase}" ///
>                 increase_FSR = "{bf:increase}" ///
>                 increase_14k = "{bf:increase}" ///
>                 increase_24k = "{bf:increase}" ///
>                 increase_all = "{bf:increase}" ///
>                 science_RW = "{bf:science}" ///
>                 science_IPS = "{bf:science}" ///
>                 science_FSR = "{bf:science}" ///
>                 science_14k = "{bf:science}" ///
>                 science_24k = "{bf:science}" ///
>                 science_all = "{bf:science}" ///
>                 fraud_RW = "{bf:fraud}" ///
>                 fraud_IPS = "{bf:fraud}" ///
>                 fraud_FSR = "{bf:fraud}" ///
>                 fraud_14k = "{bf:fraud}" ///
>                 fraud_24k = "{bf:fraud}" ///
>                 fraud_all = "{bf:fraud}" ///
>                 mmr_RW = "{bf:mmr}" ///
>                 mmr_IPS = "{bf:mmr}" ///
>                 mmr_FSR = "{bf:mmr}" ///
>                 mmr_14k = "{bf:mmr}" ///
>                 mmr_24k = "{bf:mmr}" ///
>                 mmr_all = "{bf:mmr}" ///
>                 deficit_RW = "{bf:deficit}" ///
>                 deficit_IPS = "{bf:deficit}" ///
>                 deficit_FSR = "{bf:deficit}" ///
>                 deficit_14k = "{bf:deficit}" ///
>                 deficit_24k = "{bf:deficit}" ///
>                 deficit_all = "{bf:deficit}" ///                
>                 avg_RW = "{bf:Average}" ///                                                             
>                 avg_IPS = "{bf:Average}" ///                                                            
>                 avg_FSR = "{bf:Average}" ///                                                            
>                 avg_14k = "{bf:Average}" ///                                                            
>                 avg_24k = "{bf:Average}" ///                                                            
>                 avg_all = "{bf:Average}" ///                                                            
>                 )

. 
. * Add column titles     
. addplot 1: , title("{bf:RW}", size(med)) norescaling
(note:  named style med not found in class gsize, default attributes used)

. addplot 2: , title("{bf:IPS}") norescaling

. addplot 3: , title("{bf:FSR}") norescaling

. addplot 4: , title("{bf:14k}") norescaling

. addplot 5: , title("{bf:24k}") norescaling

. 
. * graph margin
. gr_edit .style.editstyle margin(left) editcopy 

. * plot margin
. gr_edit .plotregion1.style.editstyle margin(left) editcopy

. * Remove ylabel ticks
. gr_edit .plotregion1.yaxis1[5].style.editstyle majorstyle(tickstyle(show_ticks(no))) editcopy

. * Shift labels to left
. gr_edit .plotregion1.move yaxis1[5] leftof 9 1

. 
. * reset margins back to zero to flush with new col of labels
. gr_edit .style.editstyle margin(zero) editcopy 

. gr_edit .plotregion1.style.editstyle margin(zero) editcopy

. 
. 
. graph export ../../ms/figures/partisan-gap-by-item-arm.pdf, replace     
file ../../ms/figures/partisan-gap-by-item-arm.pdf saved as PDF format

. 
. 
. * sort(, descending) /// sort by coeff size (by first column) 
> *       transform(* = min(max(@,-.25),.5)) /// truncate CI, 1st num is lower bound, 2nd num is upper bound

end of do-file

. 
. *** Balance tests (24k vs RW), takes a while
. do baltest-24k-rw.do

. 
. drop if (question_type!="24k") & (question_type!="RW")
(725 observations deleted)

. gen tarm = (question_type=="24k") 

. 
. 
. global bs_seed 0

. global nboot 10000

. 
. cap program drop run_reg_corr

. program define run_reg_corr
  1.         args xvar
  2. 
.         qui eststo: reg tarm `xvar', vce(hc3) 
  3.         global `xvar'_N = "(N=`e(N)')"
  4.         
.         rho_report tarm `xvar', seed($bs_seed) nboot($nboot)
  5.         global `xvar'_rreport = "`r(rreport)'"
  6. end

. 
. *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
. *** Run regressions and correlation
. 
. center age interest_1 vote_1 pid_strength_1, standardize inplace
(modified variables: age interest_1 vote_1 pid_strength_1)

. qui tabulate educ, gen(d_educ)

. local listofxvar female age hisla d_educ2 d_educ5 d_educ1 d_educ4 asian black white interest_1 vote_1 pid_strength_1

. 
. eststo clear 

. local i = 1

. foreach xvar of varlist `listofxvar' {
  2.         _dots `i++' 0
  3.         run_reg_corr `xvar'
  4. }
.............
. 
. *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
. *** Plot
. grstyle init

. grstyle set plain, noextend

. 
. #delimit; 
delimiter now ;
. coefplot est*,
>         mcolor(navy) msize(small) 
>         ciopts(lcolor(gs7))
>         keep(`listofxvar')               
>         eqrename(est1="Female $female_N $female_rreport"
>                          est2="Age cohort $age_N $age_rreport"
>                          est3="Hispanic/Latinx $hisla_N   $hisla_rreport"
>                          // est4="No HS diploma `d_educ3_N' `d_educ3_rreport'"
>                          est4="HS diploma $d_educ2_N $d_educ2_rreport"
>                          est5="Some college $d_educ5_N $d_educ5_rreport"
>                          est6="Four-year college $d_educ1_N $d_educ1_rreport"
>                          est7="Post-graduate $d_educ4_N $d_educ4_rreport"
>                          est8="Asian $asian_N $asian_rreport"
>                          est9="Black $black_N $black_rreport"
>                          est10="White $white_N $white_rreport"
>                          // est11="Others `others_N' `others_rreport'"
>                          est11="Political interest $interest_1_N $interest_1_rreport"
>                          est12="Intention to vote $vote_1_N $vote_1_rreport"
>                          est13="Political leaning $pid_strength_1_N $pid_strength_1_rreport"
>                          )
>         headings(
>                 "HS diploma $d_educ2_N $d_educ2_rreport"="{bf:Education}"
>                 "Asian $asian_N $asian_rreport"="{bf:Race}"
>                 "Political interest $interest_1_N $interest_1_rreport"="{bf:Politics}", 
>                 labsize(vsmall) labgap(-3.5)
>                 )
>         asequation /// "set equation to model name or string" make the rows the models
>         swapnames /// "swap coefficient names and equation names"
>         xline(0, lcolor(gs10) lpattern(dash) lwidth(medium)) ///
>         ytick(none) /// remove horizontal grids 
>         ylabel(, labsize(vsmall))
>         xlabel(-.3(.1).3, labsize(vsmall))
>         // transform(* = min(max(@,-.24),.24)) /// truncate CI, 1st num is lower bound, 2nd num is upper bound  
>         yscale(noline alt)
>         plotregion(margin(0 1 0 0) ) ///        
>         graphregion(margin(3 0 0 0)) ///        
>         title("{bf:Pearson Correlation}" "{bf:Coefficient [95% CI]}", 
>                         position(11) justification(center) size(small)
>                 )
>         legend(off)
> ;

. #delimit cr
delimiter now cr
. 
. gr_edit .yaxis1.style.editstyle majorstyle(tickstyle(show_ticks(no))) editcopy // yaxis1 edits

. 
. gr_edit .move yaxis1 leftof 8 5 // yaxis1 grid reposition

. 
. gr_edit .yaxis1.edit_tick 1 1   `"{bf:{fontface Consolas:Female $female_N              $female_rreport}}"', tickset(ma
> jor)

. gr_edit .yaxis1.edit_tick 2 2   `"{bf:{fontface Consolas:Age cohort $age_N           $age_rreport}}"', tickset(major)

. gr_edit .yaxis1.edit_tick 3 3   `"{bf:{fontface Consolas:Hispanic/Latinx $hisla_N      $hisla_rreport}}"', tickset(maj
> or)

. gr_edit .yaxis1.edit_tick 4 6   `"{bf:{fontface Consolas:HS diploma $d_educ2_N           $d_educ2_rreport}}"', tickset
> (major)

. gr_edit .yaxis1.edit_tick 5 7   `"{bf:{fontface Consolas:Some college $d_educ5_N        $d_educ5_rreport}}"', tickset(
> major)

. gr_edit .yaxis1.edit_tick 6 8   `"{bf:{fontface Consolas:Four-year college $d_educ1_N    $d_educ1_rreport}}"', tickset
> (major)

. gr_edit .yaxis1.edit_tick 7 9   `"{bf:{fontface Consolas:Post-graduate $d_educ4_N       $d_educ4_rreport}}"', tickset(
> major)

. gr_edit .yaxis1.edit_tick 8 12  `"{bf:{fontface Consolas:Asian $asian_N                $asian_rreport}}"', tickset(maj
> or)

. gr_edit .yaxis1.edit_tick 9 13  `"{bf:{fontface Consolas:Black $black_N               $black_rreport}}"', tickset(majo
> r)

. gr_edit .yaxis1.edit_tick 10 14 `"{bf:{fontface Consolas:White $white_N               $white_rreport}}"', tickset(majo
> r)

. // gr_edit .yaxis1.edit_tick 11 15 `"Others                   0.07 (-0.03 to 0.17)"', tickset(major)
. gr_edit .yaxis1.edit_tick 11 17 `"{bf:{fontface Consolas:Political interest $interest_1_N  $interest_1_rreport}}"', ti
> ckset(major)

. gr_edit .yaxis1.edit_tick 12 18 `"{bf:{fontface Consolas:Intention to vote $vote_1_N   $vote_1_rreport}}"', tickset(ma
> jor)

. gr_edit .yaxis1.edit_tick 13 19 `"{bf:{fontface Consolas:Political leaning $pid_strength_1_N   $pid_strength_1_rreport
> }}"', tickset(major)

. 
. gr_edit .title.DragBy 0 -31

. 
. graph export ../../ms/figures/baltest-24k-rw.pdf, replace       
file ../../ms/figures/baltest-24k-rw.pdf saved as PDF format

. 
end of do-file

. 
. **** Reg table for effect of party & survey type on response
. do reg-table.do

. 
. * Reshape from wide to long to stack participant-item observations
. foreach item of varlist $items {
  2.         rename `item' item`item'
  3. }

. reshape long item, i(id) j(item_type, string)
(j = birth death deficit fraud illegal increase mmr religion science)

Data                               Wide   ->   Long
-----------------------------------------------------------------------------
Number of observations              482   ->   4,338       
Number of variables                 425   ->   418         
j variable (9 values)                     ->   item_type
xij variables:
    itembirth itemdeath ... itemscience   ->   item
-----------------------------------------------------------------------------

. 
. drop if pid_str=="Independent"
(1,476 observations deleted)

. 
. 
. local spec1 i.rep

. local spec2 i.survey

. local spec3 i.rep##i.survey

. local spec4 `spec1' $demo

. local spec5 `spec2' $demo

. local spec6 `spec3' $demo

. 
. forvalues i = 1/6 {
  2. eststo: qui reghdfe item `spec`i'', absorb(item_type) vce(cluster id)
  3.         estadd local items 9
  4.         estadd local Nrespondents = e(N_clust1)
  5.         local nobs: display %9.0fc `e(N)'
  6.         estadd local itemFE "Yes"
  7.         estadd local nobs "`nobs'"
  8.         if `i' > 3 {
  9.                 estadd local demo "Yes"
 10.         }
 11.         else {
 12.                 estadd local demo "."           
 13.         }
 14. }
(est14 stored)

added macro:
              e(items) : "9"

added macro:
       e(Nrespondents) : "317"

added macro:
             e(itemFE) : "Yes"

added macro:
               e(nobs) : "    2,600"

added macro:
               e(demo) : "."
(est15 stored)

added macro:
              e(items) : "9"

added macro:
       e(Nrespondents) : "317"

added macro:
             e(itemFE) : "Yes"

added macro:
               e(nobs) : "    2,600"

added macro:
               e(demo) : "."
(est16 stored)

added macro:
              e(items) : "9"

added macro:
       e(Nrespondents) : "317"

added macro:
             e(itemFE) : "Yes"

added macro:
               e(nobs) : "    2,600"

added macro:
               e(demo) : "."
(est17 stored)

added macro:
              e(items) : "9"

added macro:
       e(Nrespondents) : "317"

added macro:
             e(itemFE) : "Yes"

added macro:
               e(nobs) : "    2,600"

added macro:
               e(demo) : "Yes"
(est18 stored)

added macro:
              e(items) : "9"

added macro:
       e(Nrespondents) : "317"

added macro:
             e(itemFE) : "Yes"

added macro:
               e(nobs) : "    2,600"

added macro:
               e(demo) : "Yes"
(est19 stored)

added macro:
              e(items) : "9"

added macro:
       e(Nrespondents) : "317"

added macro:
             e(itemFE) : "Yes"

added macro:
               e(nobs) : "    2,600"

added macro:
               e(demo) : "Yes"

. 
. 
. #delimit;
delimiter now ;
. esttab,
>         b(%9.3fc)
>         se(%9.3fc)
>         varwidth(20)
>         modelwidth(8)   
>         star (+ 0.1 * 0.05 ** 0.01 *** 0.001)
>         keep(1.rep *.survey _cons)
>         obslast
>         label
>         nobase  
>         noobs
>         nomtitle
>         scalar(
>                 "r2 R$^2$" 
>                 "itemFE Survey item FE"
>                 "demo Demographic controls"
>                 "items Items"
>                 "Nrespondents Respondents"
>                 "nobs Respondent-items"
>                 ) 
>         title("Dep. var. is 1(response is congenial)")
> ;

Dep. var. is 1(response is congenial)
------------------------------------------------------------------------------------------------------------------------
> ----------------------------------------------------------------------------------------------------------------------
> ----------
                          (1)         (2)         (3)         (4)         (5)         (6)         (7)         (8)       
>   (9)        (10)        (11)        (12)        (13)        (14)        (15)        (16)        (17)        (18)     
>    (19)   
------------------------------------------------------------------------------------------------------------------------
> ----------------------------------------------------------------------------------------------------------------------
> ----------
rep=1                                                                                                                   
>                                                             0.268***                0.375***    0.273***              
>   0.376***
                                                                                                                        
>                                                           (0.027)                 (0.030)     (0.027)                 
> (0.029)   

24k                                                                                                                     
>                                                                        -0.163***   -0.063***               -0.166***  
>  -0.067***
                                                                                                                        
>                                                                       (0.023)     (0.018)                 (0.022)     
> (0.017)   

rep=1 # 24k                                                                                                             
>                                                                                    -0.264***                          
>  -0.259***
                                                                                                                        
>                                                                                   (0.042)                             
> (0.041)   

Constant                0.533***    0.527***    0.503***    0.523***    0.535***    0.500***    0.544***    0.518***    
> 0.529***    0.559***    0.527***    0.527***    0.527***    0.146***    0.309***    0.178***    0.116***    0.302***  
>   0.155***
                      (0.032)     (0.023)     (0.104)     (0.024)     (0.027)     (0.030)     (0.025)     (0.024)     (0
> .024)     (0.052)     (0.023)     (0.023)     (0.023)     (0.009)     (0.020)     (0.017)     (0.017)     (0.026)     
> (0.019)   
------------------------------------------------------------------------------------------------------------------------
> ----------------------------------------------------------------------------------------------------------------------
> ----------
R$^2$                   0.000       0.000       0.000       0.001       0.001       0.004       0.005       0.003       
> 0.000       0.001       0.002       0.000       0.004       0.326       0.276       0.377       0.335       0.290     
>   0.386   
Survey item FE                                                                                                          
>                                                                                                                       
>           
Demographic controls                                                                                                    
>                                                                                                                       
>           
Items                                                                                                                   
>                                                                 9           9           9           9           9     
>       9   
Respondents                                                                                                             
>                                                                                                                       
>           
Respondent-items                                                                                                        
>                                                                                                                       
>           
------------------------------------------------------------------------------------------------------------------------
> ----------------------------------------------------------------------------------------------------------------------
> ----------
Standard errors in parentheses
+ p<0.1, * p<0.05, ** p<0.01, *** p<0.001

. 
end of do-file

. 
. tictoc toc
------------------------------------------------------------------------------------------------------------------------
----------- Time log -----------
Start time:  1 Dec 2021 21:05:13
End time:  1 Dec 2021 21:11:44
Elapsed seconds:       390
Elapsed minutes:         7
Elapsed hours:       .11
------------------------------------------------------------------------------------------------------------------------

. 
. log close
      name:  <unnamed>
       log:  D:\partisan-gaps\scripts\Stata\logs/partisan-gaps.txt
  log type:  text
 closed on:   1 Dec 2021, 21:11:44
------------------------------------------------------------------------------------------------------------------------
